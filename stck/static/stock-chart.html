<link rel="import" href="./bower_components/polymer/polymer.html"> <!-- Import Polymer element -->

<meta name="author" content="Andrew Fang">
<link href="./nv/nv.d3.css" rel="stylesheet" type="text/css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.min.js" charset="utf-8"></script>
<script src="./nv/nv.d3.js"></script>



<polymer-element name="stock-chart" attributes="data1d data5d data1m data3m data1y testa">
<template>
  <!-- Shadow CSS -->
  <style>
      text {
          font: 12px sans-serif;
      }
      svg {
          display: block;
      }
      #chartsvg, svg {
          margin: 0px;
          padding: 0px;
          height: 100%;
          width: 100%;
      }
  </style>

  <div id="chartsvg"></div>
</template>

<script>
    var getMinVal = function(dataset, key) {
      var minVal = Math.min();
      for (idx in dataset) {
        if (dataset[idx][key] < minVal) {
          minVal = dataset[idx][key];
        }
      }
      return minVal;
    };
    var getMaxVal = function(dataset, key) {
      var maxVal = Math.max();
      for (idx in dataset) {
        if (dataset[idx][key] > maxVal) {
          maxVal = dataset[idx][key];
       }
      }
      return maxVal;
    };
</script>
<script>
  Polymer("stock-chart", {
      ready: function() {
        console.log(this.data5d);
      },
      data1d: [],
      data5d: [],
      data1m: [],
      data3m: [],
      data1y: [],
      domReady: function() {
        this.chart;
        this.chartsvg = d3.select(this.$.chartsvg);
        this.createChart();
      },
      createChart: function() {
        var self = this;

        nv.addGraph(function() {
            self.chart = nv.models.lineChart()
                .x(function(d) { return d.time})
                .y(function(d) { return d.quote })
                .options({
                    transitionDuration: 300,
                    useInteractiveGuideline: true
                });

            self.chart.xAxis
               .axisLabel("Date")
              .tickValues([1078030800000,1122782400000,1167541200000,1251691200000])
              .tickFormat(function(d) {
                  return d3.time.format('%x')(new Date(d))
                });

            self.chart.yAxis
                .axisLabel('Price ($)')
                .tickFormat(d3.format(',.2f'));

            svg = self.chartsvg.append('svg')
                .datum(formatVal())
                .call(self.chart);

            nv.utils.windowResize(self.chart.update);

            return self.chart;
        });

        function formatVal() {
            return [
                {
                    area: false,
                    values: self.data5d,
                    key: "AAPL",
                    color: "#616161"
                }
            ];
        }
    }
  });
</script>
</polymer-element>
